name: Check for Chinese Comments

on:
  pull_request:
    branches:
      - main
  workflow_dispatch:

jobs:
  check_chinese_comments:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Search for Chinese comments
      run: |
        set -e
        # 使用扩展正则表达式模式
        pattern='[一-龥]'

        # 创建一个结果文件
        output_file=chinese_comments.txt
        : > $output_file

        # 使用 grep 查找所有包含中文字符的注释
        grep -Ern "$pattern" . \
          --exclude-dir={docs,tests,scripts,assets,node_modules,build} \
          --exclude="*.md" --exclude="*.txt" --exclude="*.html" --exclude="*.css" --exclude="*.min.js" \
          || true | tee -a $output_file

        # 如果发现了中文注释，输出注释内容及其位置
        if [ -s $output_file]; then
          echo "Chinese comments found in the following locations:"
          cat $output_file
          exit 1
        else
          echo "No Chinese comments found."
        fi



# jobs:
#   check-chinese:
#     name: Check for Chinese Characters in Code
#     runs-on: ubuntu-latest

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4

#       - name: Scan for Chinese characters
#         run: |
#           # 检查所有文件中是否包含中文字符并输出所有匹配结果
#           RESULT=$(grep -rn --include=\*.{go,py,js} --exclude-dir={.git,node_modules,html,md} '[\u4e00-\u9fff]' . || true)
#           if [ -n "$RESULT" ]; then
#             echo "$RESULT" | tee /dev/stderr
#             echo "Error: Chinese characters found in the code."
#             exit 1
#           else
#             echo "No Chinese characters found."
#           fi
